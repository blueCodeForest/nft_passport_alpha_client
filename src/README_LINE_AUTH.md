# LINE認証システム

## 現在の実装について

現在のLINE認証システムは、シンプルな認証方式を採用しています。認証の要件は以下の通りです：

1. **外部ブラウザで開いた場合**:

   - LINEで開く必要があるというメッセージを表示
   - LINEで開くボタンでLINE内ブラウザに遷移

2. **LINE内ブラウザで開かれた場合**:
   - 特にメッセージを表示せず、必要に応じて自動的にログイン処理を実行
   - LINEログイン後に友達登録が必要な場合は、友達登録画面を表示

## 認証フロー

現在の認証フローは以下の通りです：

1. アプリケーションが起動すると、`LiffProvider`がLIFF SDKを初期化
2. `LineAuthProvider`が認証状態を確認
3. LINE内ブラウザで開かれていない場合、`LineAuthRequiredScreen`を表示してLINEで開くよう促す
4. LINE内ブラウザで開かれている場合：
   - ログインしていなければ自動的にログイン処理を実行
   - 友達登録されていなければ`LineFriendshipRequiredScreen`を表示
   - すべての条件を満たしていればアプリケーションのコンテンツを表示

## 認証状態の確認

認証状態は`useLiff`フックを通じて確認できます：

```tsx
import { useLiff } from 'src/providers/LiffProvider';

function MyComponent() {
  const { isInClient, isLoggedIn, isLineFriend } = useLiff();

  // 認証状態に応じた処理
  // ...
}
```

## 高度な認証システム（一時保留中）

より高度な認証システムは現在一時保留中です。このシステムでは以下の機能を提供する予定でした：

1. **ページ単位の認証（HOC）** - 特定のページに対して異なる認証レベルを適用
2. **アクション単位の認証（フック）** - 特定のアクション（ボタンクリックなど）に対して認証を要求

これらの機能は、`authBackup`ディレクトリに保存されています。将来的に必要になった場合に再実装できるようにしています。

## バックアップされたコード

以下のコードがバックアップされています：

- `authBackup/components/molecules/` - 認証関連のUIコンポーネント
- `authBackup/components/hoc/` - 高階コンポーネント（HOC）
- `authBackup/hooks/` - 認証関連のReactフック
- `authBackup/providers/` - 認証関連のコンテキストプロバイダー
- `authBackup/services/` - 認証関連のサービスクラス
- `authBackup/types/` - 認証関連の型定義

## 将来の実装計画

将来的に高度な認証システムが必要になった場合は、以下の手順で再実装することができます：

1. バックアップされたコードを参照して必要な機能を特定
2. 現在のシンプルな認証システムを拡張または置き換え
3. 必要に応じてコードを最新の要件に合わせて更新
